"use strict";async function sendMessageToActiveTab(t){let[e]=await chrome.tabs.query({active:!0,lastFocusedWindow:!0}),a=await chrome.tabs.sendMessage(e.id,t);return a}async function startimport(t,e){let a=chrome.tabs.create({url:t[1]});function s(a,r,o){if(a==o.id&&"complete"==r.status&&o.url===t[1]){chrome.tabs.sendMessage(o.id,{type:"startimport",data:{name:e,arr:t}}),chrome.tabs.onUpdated.removeListener(s);return}}console.log(t),chrome.tabs.onUpdated.addListener(s);let r=await chrome.storage.local.get(["imports"]);void 0==(r=r.imports)?await chrome.storage.local.set({imports:[a.id]}):await chrome.storage.local.set({imports:[...r,a.id]})}chrome.tabs.onUpdated.addListener((t,e,a)=>{}),chrome.runtime.onInstalled.addListener(()=>{chrome.tabs.create({url:"onboarding.html"})}),chrome.runtime.setUninstallURL("https://github.com/frostdevelop/exportplaylist/"),chrome.tabs.onRemoved.addListener(async t=>{let e=await chrome.storage.local.get(["imports"]);e=e.imports;let a=e.indexOf(t);-1!=a&&(e.splice(a,1),await chrome.storage.local.set({imports:e}))}),chrome.runtime.onMessage.addListener(async(t,e,a)=>{let{type:s,data:r}=t;if(console.log(s),"startimport"===s&&(startimport(r.arr,r.name),console.log("Starting import")),"importdone"===s&&(await chrome.tabs.remove(e.tab.id),console.log("Import finished",r.name)),"stopimport"===s){let o=await chrome.storage.local.get(["imports"]);if(o=o.imports,console.log(o),void 0!=o){for(let i=0;i<o.length;i++)try{await chrome.tabs.remove(o[i])}catch(n){console.error("Tab removing error:",n)}await chrome.storage.local.set({imports:[]})}}});